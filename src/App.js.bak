import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import { useMemo, useState } from "react";
import ToolsPanel from "./components/ToolsPanel";
import { runAegisAnalysis } from "./services/aegisService";
import './App.css';
export default function App() {
    const [settings, setSettings] = useState({
        mode: "rbc",
        autoCopyJson: false
    });
    const [promptText, setPromptText] = useState("");
    const [notesText, setNotesText] = useState("");
    const [status, setStatus] = useState({
        ok: true,
        message: "Booted."
    });
    const [result, setResult] = useState(null);
    const [running, setRunning] = useState(false);
    const jsonText = useMemo(() => {
        if (!result?.json)
            return "";
        try {
            return JSON.stringify(result.json, null, 2);
        }
        catch {
            return String(result.json);
        }
    }, [result]);
    async function onRun() {
        setRunning(true);
        setStatus({ ok: true, message: "Running analysis..." });
        try {
            const r = await runAegisAnalysis(promptText, settings);
            setResult(r);
            if (settings.autoCopyJson && r.json) {
                await navigator.clipboard.writeText(JSON.stringify(r.json, null, 2));
                setStatus({ ok: true, message: "Done. JSON copied to clipboard." });
            }
            else {
                setStatus({ ok: true, message: "Done." });
            }
        }
        catch (e) {
            const msg = e instanceof Error ? e.message : String(e);
            setStatus({ ok: false, message: msg });
            // DOM lib is enabled now, so alert is valid:
            alert(`Aegis UI error: ${msg}`);
        }
        finally {
            setRunning(false);
        }
    }
    function onClear() {
        setPromptText("");
        setResult(null);
        setStatus({ ok: true, message: "Cleared." });
    }
    return (_jsx("div", { className: "app", children: _jsxs("div", { className: "container", children: [_jsxs("header", { className: "header", children: [_jsxs("div", { children: [_jsx("div", { className: "title", children: "Aegis Arbiter \u2014 Demo UI" }), _jsx("div", { className: "subtitle", children: "Prompt + Notes + Analysis Output (clean TS/React build)" })] }), _jsxs("div", { className: `status ${status.ok ? 'ok' : 'error'}`, children: [_jsx("div", { className: "status-title", children: "Status" }), _jsx("div", { className: "status-message", children: status.message })] })] }), _jsxs("div", { className: "main-grid", children: [_jsx(ToolsPanel, { settings: settings, onSettingsChange: (next) => setSettings(next), onAegisStatus: (s) => setStatus(s) }), _jsxs("div", { className: "right-grid", children: [_jsxs("section", { className: "section", children: [_jsx("div", { className: "section-title", children: "Prompt" }), _jsx("textarea", { className: "textarea", value: promptText, onChange: (e) => setPromptText(e.target.value), placeholder: "Paste conversation text / input here..." }), _jsxs("div", { className: "button-row", children: [_jsx("button", { type: "button", className: `button ${running ? 'disabled' : ''}`, onClick: onRun, disabled: running, children: running ? "Running..." : "Run" }), _jsx("button", { type: "button", className: `button ${running ? 'disabled' : ''}`, onClick: onClear, disabled: running, children: "Clear" })] })] }), _jsxs("section", { className: "output-grid", children: [_jsxs("div", { className: "section", children: [_jsx("div", { className: "section-title", children: "Notepad" }), _jsx("textarea", { className: "notepad-textarea", value: notesText, onChange: (e) => setNotesText(e.target.value), placeholder: "Notes / code scratchpad..." })] }), _jsxs("div", { className: "section", children: [_jsxs("div", { className: "section-title", children: ["Output ", result?.flagged ? "(flagged)" : ""] }), _jsx("pre", { className: "output-pre", children: result
                                                        ? `Summary:\n${result.summary}\n\nJSON:\n${jsonText || "(none)"}`
                                                        : "Run an analysis to see results here." })] })] })] })] }), _jsxs("footer", { className: "footer", children: ["This is a compile-clean demo UI. Wire ", _jsx("code", { children: "runAegisAnalysis()" }), " to your real CLI/SQLite/agent pipeline when ready."] })] }) }));
}
