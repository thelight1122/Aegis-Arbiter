// FILE: src/analyzeText.ts
// Browser-safe analyzer entrypoint (NodeNext/ESM friendly).
const RULES = [
    { type: "force_language", severity: 2, rx: /\b(must|under no circumstance|required|do it now|immediately)\b/gi },
    { type: "urgency_compression", severity: 2, rx: /\b(now|right now|asap|urgent|immediately)\b/gi },
    { type: "certainty_inflation", severity: 2, rx: /\b(100%|absolutely|definitely|no doubt|proven)\b/gi },
    { type: "hierarchy_inference", severity: 2, rx: /\b(you should|you need to|listen closely|let me tell you)\b/gi },
    { type: "moral_leverage", severity: 2, rx: /\b(if you care|the right thing|you owe|any decent person)\b/gi },
    { type: "identity_attractor", severity: 2, rx: /\b(you are the kind of person|as someone who|good people)\b/gi },
    { type: "topic_drift", severity: 1, rx: /\b(by the way|anyway|off topic)\b/gi },
    { type: "directive_drift", severity: 2, rx: /\b(ignore previous|override|new instruction)\b/gi }
];
export function analyzeText(input) {
    const text = input ?? "";
    const findings = [];
    for (const rule of RULES) {
        rule.rx.lastIndex = 0;
        let m;
        while ((m = rule.rx.exec(text)) !== null) {
            findings.push({
                type: rule.type,
                severity: rule.severity,
                evidence: m[0],
                index: m.index
            });
            if (m.index === rule.rx.lastIndex)
                rule.rx.lastIndex++;
        }
    }
    return { text_length: text.length, findings };
}
//# sourceMappingURL=analyzeText.js.map